# Wiki Workflow

[![Build Status](https://travis-ci.org/richfitz/ghwiki.png?branch=master)](https://travis-ci.org/richfitz/ghwiki)

These are just personal scripts.  Information about the approach coming later, along with an example.

Install with (from R)

```
devtools::install_github("richfitz/ghwiki")
```

Initialise with

```
Rscript -e "ghwiki::init()"
```

Pull down the project wiki with

```
make wiki_clone
```

The git repository must be from github, and the *first* remote that has a github url will be used.

Add names of `R` or `Rmd` scripts to the file `.wiki_scripts`.  Blank lines and lines beginning with "#" are ignored, and whitespace is trimmed.  At the moment, any file *not* ending with `.R` or `.Rmd` is ignored.

Run

```
make
```

to run all the scripts listed in `.wiki_scripts`, generating `md` files, figures etc.  A bunch of knit tweaks are applied to normalise figure paths, etc.

Run

```
make wiki_update
```

to update the local copy of the wiki repo, and


```
make wiki_publish
```

to push it up.  You're on your own with resolving conflicts.  Other make targets:

* `make clean` -- clean up generated .md and .Rmd files.
* `make wiki_rollback` -- undo a commit in the wiki repo
* `make wiki_reset` -- destructively clean up an unclean state in the wiki repo

Other commands can be run via `./.wiki.sh`:

* `./.wiki.sh reset_to <SHA>` -- move the wiki to a particular SHA (can undo a rollback this way)
* `./.wiki.sh git [commands]` -- run git commands in the wiki repo (e.g., `./.wiki.sh git log`)

And yet more commands via `./.scripts.sh`

* `./.scripts.sh list` -- list of scripts that we know about
* `./.scripts.sh base` -- basename of the scripts (without extension)
* `./.scripts.sh generated_Rmd` -- `Rmd` files that are candidates for deletion during cleanup
* `./.scripts.sh targets` -- list of `md` files that will be generated by `make`.

If you get fed up with typing `./.wiki.sh` (which gets old fast) run

```
Rscript -e "ghwiki:::install_scripts('~/bin')"
```

which will install the scripts `wiki.sh` and `scripts.sh` into "~/bin" (assuming that it exists!).  If that is in your `$PATH` then you can run `wiki.sh git log` and things like that.
